import{u as U,f as le,h as te,i as M,j as se,P as ae,t as ie,k as oe,l as A,m as b,p as re,q as Y,s as t,v as he,R as T,x as ce,y as me,z as ue,C as ne,A as we,B as ve,D as de,E as pe,F as ze,G as ye,H as fe,I as $,J as I,K as ge,L as x,M as ke}from"./app-Bp5gcCrM.js";const He=["/","/en/","/zh/assets.html","/zh/catalog.html","/zh/de.html","/zh/","/zh/md.html","/zh/sitehelp.html","/zh/up.html","/zh/branch/","/zh/account/apkxa.html","/zh/account/google.html","/zh/account/","/zh/account/ios.html","/zh/account/twitch.html","/zh/markdown/","/zh/mw/game-info.html","/zh/mw/","/zh/mw/mw-press.html","/zh/mwt/game-info.html","/zh/mwt/","/zh/branch/mw-card/","/zh/markdown/other/","/zh/mw/collection/cn-warships.html","/zh/mw/collection/cn.html","/zh/mw/collection/ct.html","/zh/mw/collection/ctto.html","/zh/mw/collection/dpm.html","/zh/mw/collection/egg.html","/zh/mw/collection/events-less.html","/zh/mw/collection/game-modes.html","/zh/mw/collection/","/zh/mw/collection/lj.html","/zh/mw/collection/market.html","/zh/mw/collection/musk.html","/zh/mw/collection/mw68.html","/zh/mw/collection/mw70.html","/zh/mw/collection/mw77.html","/zh/mw/collection/mw78.html","/zh/mw/collection/mw79.html","/zh/mw/collection/mwben.html","/zh/mw/collection/news.html","/zh/mw/collection/pan.html","/zh/mw/column/","/zh/mw/download/app.html","/zh/mw/download/","/zh/mw/download/mod.html","/zh/mw/download/pc.html","/zh/mw/download/sys.html","/zh/mw/download/zg.html","/zh/mw/official/bp.html","/zh/mw/official/bs.html","/zh/mw/official/","/zh/mw/official/jd.html","/zh/mw/official/lt.html","/zh/mw/official/qt.html","/zh/mw/official/sc.html","/zh/mw/official/sd.html","/zh/mw/official/wf.html","/zh/mw/official/yj.html","/zh/mw/official/zb.html","/zh/mw/official/zd.html","/zh/mw/official/zh.html","/zh/mw/official/zy.html","/zh/mw/skills/cyct.html","/zh/mw/skills/game.html","/zh/mw/skills/","/zh/mw/skills/mom.html","/zh/mw/skills/mw-rules.html","/zh/mw/skills/stan-bilibili.html","/zh/mw/skills/x51.html","/zh/mwt/collection/","/zh/mwt/collection/link.html","/zh/mw/column/realitymw/bomber.html","/zh/mw/column/realitymw/fighter.html","/zh/mw/column/realitymw/helicopter.html","/zh/mw/column/realitymw/","/zh/mw/column/realitymw/strike-fighters.html","/zh/mw/column/realitymw/uav.html","/zh/mw/column/realitymw2/cruiser.html","/zh/mw/column/realitymw2/destroyer.html","/zh/mw/column/realitymw2/","/404.html"],Re="SEARCH_PRO_QUERY_HISTORY",z=U(Re,[]),be=()=>{const{queryHistoryCount:s}=x,a=s>0;return{enabled:a,queryHistory:z,addQueryHistory:i=>{a&&(z.value=Array.from(new Set([i,...z.value.slice(0,s-1)])))},removeQueryHistory:i=>{z.value=[...z.value.slice(0,i),...z.value.slice(i+1)]}}},E=s=>He[s.id]+("anchor"in s?`#${s.anchor}`:""),xe="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:_}=x,y=U(xe,[]),Qe=()=>{const s=_>0;return{enabled:s,resultHistory:y,addResultHistory:a=>{if(s){const i={link:E(a),display:a.display};"header"in a&&(i.header=a.header),y.value=[i,...y.value.slice(0,_-1)]}},removeResultHistory:a=>{y.value=[...y.value.slice(0,a),...y.value.slice(a+1)]}}},qe=s=>{const a=ne(),i=M(),Q=we(),r=A(0),k=b(()=>r.value>0),v=ve([]);return de(()=>{const{search:d,terminate:q}=pe(),f=ge(m=>{const g=m.join(" "),{searchFilter:S=w=>w,splitWord:C,suggestionsFilter:F,...p}=a.value;g?(r.value+=1,d(m.join(" "),i.value,p).then(w=>S(w,g,i.value,Q.value)).then(w=>{r.value-=1,v.value=w}).catch(w=>{console.warn(w),r.value-=1,r.value||(v.value=[])})):v.value=[]},x.searchDelay-x.suggestDelay);Y([s,i],([m])=>f(m),{immediate:!0}),ze(()=>{q()})}),{isSearching:k,results:v}};var Ce=le({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(s,{emit:a}){const i=te(),Q=M(),r=se(ae),{enabled:k,addQueryHistory:v,queryHistory:d,removeQueryHistory:q}=be(),{enabled:f,resultHistory:m,addResultHistory:g,removeResultHistory:S}=Qe(),C=k||f,F=ie(s,"queries"),{results:p,isSearching:w}=qe(F),o=oe({isQuery:!0,index:0}),u=A(0),n=A(0),P=b(()=>C&&(d.value.length>0||m.value.length>0)),L=b(()=>p.value.length>0),D=b(()=>p.value[u.value]||null),B=()=>{const{isQuery:e,index:l}=o;l===0?(o.isQuery=!e,o.index=e?m.value.length-1:d.value.length-1):o.index=l-1},G=()=>{const{isQuery:e,index:l}=o;l===(e?d.value.length-1:m.value.length-1)?(o.isQuery=!e,o.index=0):o.index=l+1},J=()=>{u.value=u.value>0?u.value-1:p.value.length-1,n.value=D.value.contents.length-1},K=()=>{u.value=u.value<p.value.length-1?u.value+1:0,n.value=0},V=()=>{n.value<D.value.contents.length-1?n.value+=1:K()},N=()=>{n.value>0?n.value-=1:J()},j=e=>e.map(l=>ke(l)?l:t(l[0],l[1])),W=e=>{if(e.type==="customField"){const l=ye[e.index]||"$content",[h,R=""]=fe(l)?l[Q.value].split("$content"):l.split("$content");return e.display.map(c=>t("div",j([h,...c,R])))}return e.display.map(l=>t("div",j(l)))},H=()=>{u.value=0,n.value=0,a("updateQuery",""),a("close")},X=()=>k?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},r.value.queryHistory),d.value.map((e,l)=>t("div",{class:["search-pro-result-item",{active:o.isQuery&&o.index===l}],onClick:()=>{a("updateQuery",e)}},[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},e),t("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:h=>{h.preventDefault(),h.stopPropagation(),q(l)}})]))])):null,Z=()=>f?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},r.value.resultHistory),m.value.map((e,l)=>t(T,{to:e.link,class:["search-pro-result-item",{active:!o.isQuery&&o.index===l}],onClick:()=>{H()}},()=>[t($,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(h=>j(h)).flat())]),t("button",{class:"search-pro-remove-icon",innerHTML:I,onClick:h=>{h.preventDefault(),h.stopPropagation(),S(l)}})]))])):null;return re("keydown",e=>{if(s.isFocusing){if(L.value){if(e.key==="ArrowUp")N();else if(e.key==="ArrowDown")V();else if(e.key==="Enter"){const l=D.value.contents[n.value];v(s.queries.join(" ")),g(l),i.push(E(l)),H()}}else if(f){if(e.key==="ArrowUp")B();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const{index:l}=o;o.isQuery?(a("updateQuery",d.value[l]),e.preventDefault()):(i.push(m.value[l].link),H())}}}}),Y([u,n],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result-wrapper",{empty:s.queries.length?!L.value:!P.value}],id:"search-pro-results"},s.queries.length?w.value?t(he,{hint:r.value.searching}):L.value?t("ul",{class:"search-pro-result-list"},p.value.map(({title:e,contents:l},h)=>{const R=u.value===h;return t("li",{class:["search-pro-result-list-item",{active:R}]},[t("div",{class:"search-pro-result-title"},e||r.value.defaultTitle),l.map((c,ee)=>{const O=R&&n.value===ee;return t(T,{to:E(c),class:["search-pro-result-item",{active:O,"aria-selected":O}],onClick:()=>{v(s.queries.join(" ")),g(c),H()}},()=>[c.type==="text"?null:t(c.type==="title"?ce:c.type==="heading"?me:ue,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[c.type==="text"&&c.header?t("div",{class:"content-header"},c.header):null,t("div",W(c))])])})])})):r.value.emptyResult:C?P.value?[X(),Z()]:r.value.emptyHistory:r.value.emptyResult)}});export{Ce as default};
